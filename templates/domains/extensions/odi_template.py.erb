# load common defs
execfile('<%= @download_dir %>/utils.py')

WLHOME = '<%= @weblogic_home_dir %>'
DOMAIN_PATH = '<%= @domain_dir %>'
DOMAIN = '<%= @domain_name %>'
<% if @wls_apps_inside_domain %>
APP_PATH = '<%= @domain_dir %>/applications'
<% elsif @apps_dir %>
APP_PATH = '<%= @apps_dir %>/<%= @domain_name %>'
<% end %>

JSSE_ENABLED = <%= @jsse_enabled %>
WEBTIER_ENABLED = <%= @webtier_enabled %>
CUSTOM_IDENTITY_ENABLED = <%= @custom_identity %>
DEVELOPMENT_MODE = <%= @development_mode %>
WEBLOGIC_VERSION = <%= @version %>

ADMIN_SERVER = '<%= @adminserver_name %>'
ADMIN_USER = '<%= @weblogic_user %>'
ADMIN_PASSWORD = '<%= @weblogic_password %>'

JAVA_HOME = '<%= @jdk_home_dir %>'
NODEMANAGER_SECURE_LISTENER = <%= @nodemanager_secure_listener %>

<% if @java_arguments['ADM'] %>
ADM_JAVA_ARGUMENTS = '<%= @java_arguments['ADM'] %>'
<% else %>
ADM_JAVA_ARGUMENTS = '-XX:PermSize=256m -XX:MaxPermSize=512m -Xms1024m -Xmx1024m -Dweblogic.Stdout=<%= @admin_nodemanager_log_dir %>/<%= @adminserver_name %>.out -Dweblogic.Stderr=<%= @admin_nodemanager_log_dir %>/<%= @adminserver_name %>_err.out'
<% end %>

REPOS_DBURL = '<%= @repository_database_url %>'
REPOS_DBUSER_PREFIX = '<%= @repository_prefix %>'
REPOS_DBPASSWORD = '<%= @repository_password %>'
db_driver = 'oracle.jdbc.OracleDriver'
db_user = '<%= @repository_prefix %>'_STB


RESTRICTED = False
<%- unless @restricted.nil? then -%>
RESTRICTED = True
<% end %>

readDomain(DOMAIN_PATH)

change_server_arguments(ADMIN_SERVER, ADM_JAVA_ARGUMENTS)

cd('/')

if APP_PATH:
  print('Set AppDir to ' + APP_PATH )
  setOption('AppDir', APP_PATH )

addTemplate('Oracle Enterprise Manager Plugin for ODI')
addTemplate('Oracle Data Integrator - Agent')
addTemplate('Oracle Data Integrator - Console')
addTemplate('Oracle Data Integrator - JRF Async Web Services')


dumpStack()

print 'weblogic version' + str(WEBLOGIC_VERSION)

print('Create supervisor credential.')
cd('/SecurityConfiguration/base_domain')
cmo.setUseKSSForDemo(false)
cd('/Credential/TargetStore/oracle.odi.credmap/TargetKey/SUPERVISOR')
create('c','Credential')
cd('Credential')
cmo.setUsername('SUPERVISOR')
cmo.setPassword(REPOS_DBPASSWORD)

print('Create data source.')
cd('/JDBCSystemResource/LocalSvcTblDataSource/JdbcResource/LocalSvcTblDataSource/JDBCDriverParams/NO_NAME_0')
cmo.setPasswordEncrypted(REPOS_DBPASSWORD)
cmo.setUrl(REPOS_DBURL)
cmo.setDriverName(db_driver)
cd('Properties/NO_NAME_0/Property/user')
cmo.setValue(db_user)


dumpStack()
updateDomain()
dumpStack()
closeDomain()

print('Exiting...')
exit()
